/*! visualCaptcha - v0.0.8 - 2016-01-23
* http://visualcaptcha.net
* Copyright (c) 2016 emotionLoop; Licensed MIT */(function(root,factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else{factory(root.jQuery);}}(this,function($){var requirejs,require,define;(function(undef){var main,req,makeMap,handlers,defined={},waiting={},config={},defining={},hasOwn=Object.prototype.hasOwnProperty,aps=[].slice,jsSuffixRegExp=/\.js$/;function hasProp(obj,prop){return hasOwn.call(obj,prop);}
function normalize(name,baseName){var nameParts,nameSegment,mapValue,foundMap,lastIndex,foundI,foundStarMap,starI,i,j,part,baseParts=baseName&&baseName.split("/"),map=config.map,starMap=(map&&map['*'])||{};if(name&&name.charAt(0)==="."){if(baseName){baseParts=baseParts.slice(0,baseParts.length-1);name=name.split('/');lastIndex=name.length-1;if(config.nodeIdCompat&&jsSuffixRegExp.test(name[lastIndex])){name[lastIndex]=name[lastIndex].replace(jsSuffixRegExp,'');}
name=baseParts.concat(name);for(i=0;i<name.length;i+=1){part=name[i];if(part==="."){name.splice(i,1);i-=1;}else if(part===".."){if(i===1&&(name[2]==='..'||name[0]==='..')){break;}else if(i>0){name.splice(i-1,2);i-=2;}}}
name=name.join("/");}else if(name.indexOf('./')===0){name=name.substring(2);}}
if((baseParts||starMap)&&map){nameParts=name.split('/');for(i=nameParts.length;i>0;i-=1){nameSegment=nameParts.slice(0,i).join("/");if(baseParts){for(j=baseParts.length;j>0;j-=1){mapValue=map[baseParts.slice(0,j).join('/')];if(mapValue){mapValue=mapValue[nameSegment];if(mapValue){foundMap=mapValue;foundI=i;break;}}}}
if(foundMap){break;}
if(!foundStarMap&&starMap&&starMap[nameSegment]){foundStarMap=starMap[nameSegment];starI=i;}}
if(!foundMap&&foundStarMap){foundMap=foundStarMap;foundI=starI;}
if(foundMap){nameParts.splice(0,foundI,foundMap);name=nameParts.join('/');}}
return name;}
function makeRequire(relName,forceSync){return function(){return req.apply(undef,aps.call(arguments,0).concat([relName,forceSync]));};}
function makeNormalize(relName){return function(name){return normalize(name,relName);};}
function makeLoad(depName){return function(value){defined[depName]=value;};}
function callDep(name){if(hasProp(waiting,name)){var args=waiting[name];delete waiting[name];defining[name]=true;main.apply(undef,args);}
if(!hasProp(defined,name)&&!hasProp(defining,name)){throw new Error('No '+name);}
return defined[name];}
function splitPrefix(name){var prefix,index=name?name.indexOf('!'):-1;if(index>-1){prefix=name.substring(0,index);name=name.substring(index+1,name.length);}
return[prefix,name];}
makeMap=function(name,relName){var plugin,parts=splitPrefix(name),prefix=parts[0];name=parts[1];if(prefix){prefix=normalize(prefix,relName);plugin=callDep(prefix);}
if(prefix){if(plugin&&plugin.normalize){name=plugin.normalize(name,makeNormalize(relName));}else{name=normalize(name,relName);}}else{name=normalize(name,relName);parts=splitPrefix(name);prefix=parts[0];name=parts[1];if(prefix){plugin=callDep(prefix);}}
return{f:prefix?prefix+'!'+name:name,n:name,pr:prefix,p:plugin};};function makeConfig(name){return function(){return(config&&config.config&&config.config[name])||{};};}
handlers={require:function(name){return makeRequire(name);},exports:function(name){var e=defined[name];if(typeof e!=='undefined'){return e;}else{return(defined[name]={});}},module:function(name){return{id:name,uri:'',exports:defined[name],config:makeConfig(name)};}};main=function(name,deps,callback,relName){var cjsModule,depName,ret,map,i,args=[],callbackType=typeof callback,usingExports;relName=relName||name;if(callbackType==='undefined'||callbackType==='function'){deps=!deps.length&&callback.length?['require','exports','module']:deps;for(i=0;i<deps.length;i+=1){map=makeMap(deps[i],relName);depName=map.f;if(depName==="require"){args[i]=handlers.require(name);}else if(depName==="exports"){args[i]=handlers.exports(name);usingExports=true;}else if(depName==="module"){cjsModule=args[i]=handlers.module(name);}else if(hasProp(defined,depName)||hasProp(waiting,depName)||hasProp(defining,depName)){args[i]=callDep(depName);}else if(map.p){map.p.load(map.n,makeRequire(relName,true),makeLoad(depName),{});args[i]=defined[depName];}else{throw new Error(name+' missing '+depName);}}
ret=callback?callback.apply(defined[name],args):undefined;if(name){if(cjsModule&&cjsModule.exports!==undef&&cjsModule.exports!==defined[name]){defined[name]=cjsModule.exports;}else if(ret!==undef||!usingExports){defined[name]=ret;}}}else if(name){defined[name]=callback;}};requirejs=require=req=function(deps,callback,relName,forceSync,alt){if(typeof deps==="string"){if(handlers[deps]){return handlers[deps](callback);}
return callDep(makeMap(deps,callback).f);}else if(!deps.splice){config=deps;if(config.deps){req(config.deps,config.callback);}
if(!callback){return;}
if(callback.splice){deps=callback;callback=relName;relName=null;}else{deps=undef;}}
callback=callback||function(){};if(typeof relName==='function'){relName=forceSync;forceSync=alt;}
if(forceSync){main(undef,deps,callback,relName);}else{setTimeout(function(){main(undef,deps,callback,relName);},4);}
return req;};req.config=function(cfg){return req(cfg);};requirejs._defined=defined;define=function(name,deps,callback){if(!deps.splice){callback=deps;deps=[];}
if(!hasProp(defined,name)&&!hasProp(waiting,name)){waiting[name]=[name,deps,callback];}};define.amd={jQuery:true};}());define("almond",function(){});define('visualcaptcha/core',[],function(){'use strict';var _addUrlParams,_refresh,_startUrl,_imageUrl,_audioUrl,_imageValue,_isRetina,_supportsAudio;_addUrlParams=function(config,url,params){params=params||[];if(config.namespace&&config.namespace.length>0){params.push(config.namespaceFieldName+'='+config.namespace);}
params.push(config.randomParam+'='+config.randomNonce);return url+'?'+params.join('&');};_refresh=function(config){var core=this,startURL;config.applyRandomNonce();config.isLoading=true;startURL=_startUrl(config);config._loading(core);if(config.callbacks.loading){config.callbacks.loading(core);}
config.request(startURL,function(response){if(response.audioFieldName){config.audioFieldName=response.audioFieldName;}
if(response.imageFieldName){config.imageFieldName=response.imageFieldName;}
if(response.imageName){config.imageName=response.imageName;}
if(response.values){config.imageValues=response.values;}
config.isLoading=false;config.hasLoaded=true;config._loaded(core);if(config.callbacks.loaded){config.callbacks.loaded(core);}});};_startUrl=function(config){var url=config.url+config.routes.start+'/'+config.numberOfImages;return _addUrlParams(config,url);};_imageUrl=function(config,i){var url='',params=[];if(i<0||i>=config.numberOfImages){return url;}
if(this.isRetina()){params.push('retina=1');}
url=config.url+config.routes.image+'/'+i;return _addUrlParams(config,url,params);};_audioUrl=function(config,ogg){var url=config.url+config.routes.audio;if(ogg){url+='/ogg';}
return _addUrlParams(config,url);};_imageValue=function(config,i){if(i>=0&&i<config.numberOfImages){return config.imageValues[i];}
return '';};_isRetina=function(){return(window.devicePixelRatio!==undefined&&window.devicePixelRatio>1);};_supportsAudio=function(){var audioElement,support=false;try{audioElement=document.createElement('audio');if(audioElement.canPlayType){support=true;}}catch(e){}
return support;};return function(config){var core,refresh,isLoading,hasLoaded,numberOfImages,imageName,imageValue,imageUrl,audioUrl,imageFieldName,audioFieldName,namespace,namespaceFieldName;refresh=function(){return _refresh.call(this,config);};isLoading=function(){return config.isLoading;};hasLoaded=function(){return config.hasLoaded;};numberOfImages=function(){return config.imageValues.length;};imageName=function(){return config.imageName;};imageValue=function(index){return _imageValue.call(this,config,index);};imageUrl=function(index){return _imageUrl.call(this,config,index);};audioUrl=function(ogg){return _audioUrl.call(this,config,ogg);};imageFieldName=function(){return config.imageFieldName;};audioFieldName=function(){return config.audioFieldName;};namespace=function(){return config.namespace;};namespaceFieldName=function(){return config.namespaceFieldName;};core={refresh:refresh,isLoading:isLoading,hasLoaded:hasLoaded,numberOfImages:numberOfImages,imageName:imageName,imageValue:imageValue,imageUrl:imageUrl,audioUrl:audioUrl,imageFieldName:imageFieldName,audioFieldName:audioFieldName,namespace:namespace,namespaceFieldName:namespaceFieldName,isRetina:_isRetina,supportsAudio:_supportsAudio};if(config.autoRefresh){core.refresh();}
return core;};});define('visualcaptcha/xhr-request',[],function(){'use strict';var XMLHttpRequest=window.XMLHttpRequest;return function(url,callback){var ajaxRequest=new XMLHttpRequest();ajaxRequest.open('GET',url,true);ajaxRequest.onreadystatechange=function(){var response;if(ajaxRequest.readyState!==4||ajaxRequest.status!==200){return;}
response=JSON.parse(ajaxRequest.responseText);callback(response);};ajaxRequest.send();};});define('visualcaptcha/config',['visualcaptcha/xhr-request'],function(xhrRequest){'use strict';return function(options){var urlArray=window.location.href.split('/');urlArray[urlArray.length-1]='';var config={request:xhrRequest,url:urlArray.join('/').slice(0,-1),namespace:'',namespaceFieldName:'namespace',routes:{start:'/Plugins/VisualCaptcha/Handler.ashx/start',image:'/Plugins/VisualCaptcha/Handler.ashx/image',audio:'/Plugins/VisualCaptcha/Handler.ashx/audio'},isLoading:false,hasLoaded:false,autoRefresh:true,numberOfImages:6,randomNonce:'',randomParam:'r',audioFieldName:'',imageFieldName:'',imageName:'',imageValues:[],callbacks:{},_loading:function(){},_loaded:function(){}};config.applyRandomNonce=function(){return(config.randomNonce=Math.random().toString(36).substring(2));};if(options.request){config.request=options.request;}
if(options.url){config.url=options.url;}
if(options.namespace){config.namespace=options.namespace;}
if(options.namespaceFieldName){config.namespaceFieldName=options.namespaceFieldName;}
if(typeof options.autoRefresh!=='undefined'){config.autoRefresh=options.autoRefresh;}
if(options.numberOfImages){config.numberOfImages=options.numberOfImages;}
if(options.routes){if(options.routes.start){config.routes.start=options.routes.start;}
if(options.routes.image){config.routes.image=options.routes.image;}
if(options.routes.audio){config.routes.audio=options.routes.audio;}}
if(options.randomParam){config.randomParam=options.randomParam;}
if(options.callbacks){if(options.callbacks.loading){config.callbacks.loading=options.callbacks.loading;}
if(options.callbacks.loaded){config.callbacks.loaded=options.callbacks.loaded;}}
if(options._loading){config._loading=options._loading;}
if(options._loaded){config._loaded=options._loaded;}
return config;};});define('visualcaptcha',['require','visualcaptcha/core','visualcaptcha/config'],function(require){'use strict';var core=require('visualcaptcha/core'),config=require('visualcaptcha/config');return function(options){options=options||{};return core(config(options));};});define('visualcaptcha/templates',[],function(){'use strict';var _t,_buttonsHTML,_accessibilityHTML,_imagesHTML,_audioInputHTML,_imageInputHTML,_namespaceInputHTML;_t=function(str,d){for(var p in d){str=str.replace(new RegExp('{'+p+'}','g'),d[p]);}
return str;};_buttonsHTML=function(captcha,language,path){var btnAccessibility,btnRefresh,string,params;btnAccessibility='<div class="visualCaptcha-accessibility-button">'+
'<a href="javascript:void(0);"><img src="{path}accessibility{retinaExtra}.png" title="{accessibilityTitle}" alt="{accessibilityAlt}" /></a>'+
'</div>';btnRefresh='<div class="visualCaptcha-refresh-button">'+
'<a href="javascript:void(0);"><img src="{path}refresh{retinaExtra}.png" title="{refreshTitle}" alt="{refreshAlt}" /></a>'+
'</div>';string='<div class="visualCaptcha-button-group">'+
btnRefresh+
(captcha.supportsAudio()?btnAccessibility:'')+
'</div>';params={path:path||'',refreshTitle:language.refreshTitle,refreshAlt:language.refreshAlt,accessibilityTitle:language.accessibilityTitle,accessibilityAlt:language.accessibilityAlt,retinaExtra:captcha.isRetina()?'@2x':''};return _t(string,params);};_accessibilityHTML=function(captcha,language){var string,params;if(!captcha.supportsAudio()){return '';}
string='<div class="visualCaptcha-accessibility-wrapper visualCaptcha-hide">'+
'<div class="accessibility-description">{accessibilityDescription}</div>'+
'<audio preload="preload">'+
'<source src="{audioURL}" type="audio/ogg" />'+
'<source src="{audioURL}" type="audio/mpeg" />'+
'</audio>'+
'</div>';params={accessibilityDescription:language.accessibilityDescription,audioURL:captcha.audioUrl(),audioFieldName:captcha.audioFieldName()};return _t(string,params);};_imagesHTML=function(captcha,language){var images='',string,params;for(var i=0,l=captcha.numberOfImages();i<l;i++){string='<div class="img">'+
'<a href="javascript:void(0);"><img src="{imageUrl}" id="visualCaptcha-img-{i}" data-index="{i}" alt="" title="" /></a>'+
'</div>';params={imageUrl:captcha.imageUrl(i),i:i};images+=_t(string,params);}
string='<p class="visualCaptcha-explanation">{explanation}</p>'+
'<div class="visualCaptcha-possibilities">{images}</div>';params={imageFieldName:captcha.imageFieldName(),explanation:language.explanation.replace(/ANSWER/,captcha.imageName()),images:images};return _t(string,params);};_audioInputHTML=function(captcha){var string,params;string='<input class="form-control audioField" type="text" name="{audioFieldName}" value="" autocomplete="off" />';params={audioFieldName:captcha.audioFieldName()};return _t(string,params);};_imageInputHTML=function(captcha,imageIndex){var string,params;string='<input class="form-control imageField" type="hidden" name="{imageFieldName}" value="{value}" readonly="readonly" />';params={imageFieldName:captcha.imageFieldName(),value:captcha.imageValue(imageIndex)};return _t(string,params);};_namespaceInputHTML=function(captcha){var string,params,namespace=captcha.namespace();if(!namespace||namespace.length===0){return '';}
string='<input type="hidden" name="{fieldName}" value="{value}" />';params={fieldName:captcha.namespaceFieldName(),value:namespace};return _t(string,params);};return{buttons:_buttonsHTML,accessibility:_accessibilityHTML,images:_imagesHTML,audioInput:_audioInputHTML,imageInput:_imageInputHTML,namespaceInput:_namespaceInputHTML};});define('visualcaptcha/language',[],function(){'use strict';return{accessibilityAlt:'Sound icon',accessibilityTitle:'Accessibility option: listen to a question and answer it!',accessibilityDescription:'Type below the <strong>answer</strong> to what you hear. Numbers or words:',explanation:'Click or touch the <strong>ANSWER</strong>',refreshAlt:'Refresh/reload icon',refreshTitle:'Refresh/reload: get new images and accessibility option!'};});define('visualcaptcha.jquery',['jquery','visualcaptcha','visualcaptcha/templates','visualcaptcha/language'],function($,visualCaptcha,templates,language){'use strict';var _request,_loading,_loaded,_toggleAccessibility,_chooseImage,_refreshCaptcha,_getCaptchaData;_request=function(url,callback){$.get(url,callback,'json');};_loading=function(){};_loaded=function(config,element,captcha){var captchaHTML;captchaHTML=templates.namespaceInput(captcha)+
templates.accessibility(captcha,config.language)+
templates.images(captcha,config.language)+
templates.buttons(captcha,config.language,config.imgPath);element.html(captchaHTML);};_toggleAccessibility=function(){var captchaElement=$(this).closest('.visualCaptcha'),accessibilityWrapper=captchaElement.find('.visualCaptcha-accessibility-wrapper'),possibilitiesWrapper=captchaElement.find('.visualCaptcha-possibilities'),explanation=captchaElement.find('.visualCaptcha-explanation'),audio=accessibilityWrapper.find('audio'),audioInputHTML;if(accessibilityWrapper.hasClass('visualCaptcha-hide')){possibilitiesWrapper.toggleClass('visualCaptcha-hide');explanation.toggleClass('visualCaptcha-hide');possibilitiesWrapper.find('.img').removeClass('visualCaptcha-selected');explanation.find('input').val('');audioInputHTML=templates.audioInput(captchaElement.data('captcha'));$(audioInputHTML).insertBefore(audio);accessibilityWrapper.toggleClass('visualCaptcha-hide');audio[0].load();audio[0].play();}else{audio[0].pause();accessibilityWrapper.toggleClass('visualCaptcha-hide');accessibilityWrapper.find('input').remove();explanation.toggleClass('visualCaptcha-hide');possibilitiesWrapper.toggleClass('visualCaptcha-hide');}};_chooseImage=function(){var image=$(this),captchaElement=image.closest('.visualCaptcha'),possibilitiesWrapper=captchaElement.find('.visualCaptcha-possibilities'),explanation=captchaElement.find('.visualCaptcha-explanation'),imageIndex,imageInput,imageInputHTML;imageInput=explanation.find('input');if(imageInput){imageInput.remove();possibilitiesWrapper.find('.img').removeClass('visualCaptcha-selected');}
image.addClass('visualCaptcha-selected');imageIndex=image.find('img').data('index');imageInputHTML=templates.imageInput(captchaElement.data('captcha'),imageIndex);explanation.append($(imageInputHTML));};_refreshCaptcha=function(){var captchaElement=$(this).closest('.visualCaptcha');captchaElement.data('captcha').refresh();};_getCaptchaData=function(element){var image=element.find('.imageField'),audio=element.find('.audioField'),valid=!!(image.val()||audio.val());return valid?{valid:valid,name:image.val()?image.attr('name'):audio.attr('name'),value:image.val()?image.val():audio.val()}:{valid:valid};};$.fn.visualCaptcha=function(options){var config;config=$.extend({imgPath:'/',language:language,captcha:{request:_request}},options);this.addClass('visualCaptcha').on('click','.visualCaptcha-accessibility-button',_toggleAccessibility).on('click','.visualCaptcha-refresh-button',_refreshCaptcha).on('click','.visualCaptcha-possibilities .img',_chooseImage);return this.each(function(){var element=$(this),captcha,captchaConfig;captchaConfig=$.extend(config.captcha,{_loading:_loading.bind(null,config,element),_loaded:_loaded.bind(null,config,element)});if(typeof element.data('namespace')!=='undefined'){captchaConfig.namespace=element.data('namespace');}
captcha=visualCaptcha(captchaConfig);captcha.getCaptchaData=_getCaptchaData.bind(null,element);element.data('captcha',captcha);});};});define('jquery',function(){return $;});require('visualcaptcha.jquery');}));